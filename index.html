<!DOCTYPE html>
<html>
  <head>
    <title>My Cannon</title>
    <meta charset="utf-8">    
  </head>
  <body>
    <script src="Three.js"></script>
    <script src="cannon.min.js"></script>
    <script>

      var world, mass, body, shape, timeStep=1/60,
         camera, scene, renderer, geometry, material, mesh;

      initThree();
      initCannon();
      animate();

      function initCannon() {
        world = new CANNON.World();
        world.gravity.set(0,-1,0);
        world.broadphase = new CANNON.NaiveBroadphase();
        world.solver.iterations = 10;

        var mass = 5;
        boxShape = new CANNON.Box(new CANNON.Vec3(2,2,2));            
        boxBody = new CANNON.Body({ mass: mass });
        boxBody.addShape(boxShape);
        boxBody.position.set(0,5,0);
        world.addBody(boxBody);          

        // Create a plane
        var groundShape = new CANNON.Plane();
        var groundBody = new CANNON.Body({ mass: 0 });
        groundBody.addShape(groundShape);
        groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);
        world.addBody(groundBody);    
      }

      function initThree() {
        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100 );
        camera.position.set(0,3,5);
        scene.add( camera );

        // lights
        var light, materials;
        scene.add( new THREE.AmbientLight( 0x666666 ) );
        light = new THREE.DirectionalLight( 0xffffff, 1.75 );
        light.position.set( 20,20,20 );
        scene.add( light );

        // cube
        var cubeGeo = new THREE.BoxGeometry( 1, 1, 1, 10, 10 );
        var cubeMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000 } );
        cubeMesh = new THREE.Mesh(cubeGeo, cubeMaterial);
        cubeMesh.castShadow = true;
        scene.add(cubeMesh);

        // floor
        geometry = new THREE.PlaneGeometry( 100, 100, 1, 1 );
        material = new THREE.MeshLambertMaterial( { color: 0x777777 } );
        //markerMaterial = new THREE.MeshLambertMaterial( { color: 0xff0000 } );
        floorMesh = new THREE.Mesh( geometry, material );
        floorMesh.castShadow = true;
        floorMesh.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0), -Math.PI / 2);
        floorMesh.receiveShadow = true;
        scene.add(floorMesh);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );

        document.body.appendChild( renderer.domElement );
      }

      function animate() {
        requestAnimationFrame( animate );
        updatePhysics();
        render();
      }

      function updatePhysics() {
        // Step the physics world
        world.step(timeStep);

        // Copy coordinates from Cannon.js to Three.js
        cubeMesh.position.copy(boxBody.position);
        cubeMesh.quaternion.copy(boxBody.quaternion);
      }

      function render() {
          renderer.render( scene, camera );
      }

    </script>
  </body>
</html>
